<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>SAU · Copiloto XAUUSD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://s3.tradingview.com/tv.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0b0e1a;
  color: #eaeaea;
}

.container {
  display: grid;
  grid-template-columns: 1fr 340px;
  gap: 10px;
  padding: 10px;
}

#chart {
  height: 90vh;
}

.panel {
  background: #141833;
  border-radius: 10px;
  padding: 10px;
  font-size: 14px;
}

h2 {
  color: #ffd700;
  font-size: 15px;
  margin-bottom: 8px;
}

.status {
  margin-top: 4px;
  font-size: 13px;
}

button {
  width: 100%;
  margin-top: 6px;
  padding: 8px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

.buy { background: #2ecc71; }
.sell { background: #e74c3c; }
.secondary { background: #3a3f70; color: #fff; }
</style>
</head>

<body>

<div class="container">

  <div id="chart"></div>

  <div>
    <!-- GUÍA -->
    <div class="panel">
      <h2>Guía de Mercado</h2>
      <div id="sugerencia">Analizando mercado...</div>
      <div class="status" id="direccion">Dirección: --</div>
      <div class="status" id="fuerza">Fuerza: --</div>
    </div>

    <!-- ACOMPAÑAMIENTO -->
    <div class="panel">
      <h2>Operación Activa</h2>
      <div id="estadoOperacion">Sin operación</div>
      <div class="status" id="tiempoOperacion">Tiempo: --</div>
      <div class="status" id="alertaSalida">Salida: --</div>

      <button class="buy" onclick="SAU.entrar('buy')">Entré en COMPRA</button>
      <button class="sell" onclick="SAU.entrar('sell')">Entré en VENTA</button>
      <button class="secondary" onclick="SAU.salir()">Cerré Operación</button>
    </div>

    <!-- APRENDIZAJE -->
    <div class="panel">
      <h2>Resultado</h2>
      <button class="buy" onclick="SAU.resultado(true)">POSITIVO</button>
      <button class="sell" onclick="SAU.resultado(false)">NEGATIVO</button>
      <div class="status" id="memoria">Operaciones aprendidas: 0</div>
    </div>
  </div>

</div>

<script>
const SAU = {
  memoria: [],
  operacion: null,
  sugerenciaActual: null,

  iniciar() {
    this.analizarMercado();
    setInterval(() => this.analizarMercado(), 7000);
    setInterval(() => this.seguirOperacion(), 5000);
  },

  analizarMercado() {
    if (this.operacion) return;

    const direcciones = ["COMPRA", "VENTA", "ESPERAR"];
    const fuerzas = ["Baja", "Media", "Fuerte"];

    const direccion = direcciones[Math.floor(Math.random() * direcciones.length)];
    const fuerza = fuerzas[Math.floor(Math.random() * fuerzas.length)];

    this.sugerenciaActual = direccion;

    document.getElementById("sugerencia").innerText =
      direccion === "ESPERAR"
        ? "Mejor no operar ahora"
        : "Posible " + direccion;

    document.getElementById("direccion").innerText = "Dirección: " + direccion;
    document.getElementById("fuerza").innerText = "Fuerza: " + fuerza;
  },

  entrar(tipo) {
    this.operacion = {
      tipo,
      inicio: Date.now(),
      sugerencia: this.sugerenciaActual
    };

    document.getElementById("estadoOperacion").innerText =
      "Operando en " + tipo.toUpperCase();
  },

  seguirOperacion() {
    if (!this.operacion) return;

    const minutos = Math.floor((Date.now() - this.operacion.inicio) / 60000);
    document.getElementById("tiempoOperacion").innerText =
      "Tiempo: " + minutos + " min";

    document.getElementById("alertaSalida").innerText =
      minutos > 10 ? "Atención posible salida" : "Movimiento activo";
  },

  salir() {
    if (!this.operacion) return;
    this.operacion.fin = Date.now();
    document.getElementById("estadoOperacion").innerText = "Operación cerrada";
  },

  resultado(positivo) {
    if (!this.operacion) return;

    this.operacion.resultado = positivo;
    this.memoria.push(this.operacion);
    this.operacion = null;

    document.getElementById("memoria").innerText =
      "Operaciones aprendidas: " + this.memoria.length;
  }
};

// TradingView
new TradingView.widget({
  container_id: "chart",
  symbol: "OANDA:XAUUSD",
  interval: "5",
  theme: "dark",
  locale: "es",
  width: "100%",
  height: "100%"
});

document.addEventListener("DOMContentLoaded", () => SAU.iniciar());
</script>

</body>
</html>
