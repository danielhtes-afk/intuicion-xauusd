<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>IntuiciÃ³n XAUUSD â€“ IA Copiloto</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0f1220;color:#eaeaff}
header{background:#161a33;padding:12px;text-align:center;font-size:20px;font-weight:bold}
.container{display:grid;grid-template-columns:2fr 1fr;gap:10px;padding:10px}
.card{background:#161a33;border-radius:10px;padding:10px}
h3{color:#7dd3fc;margin:6px 0}
button,textarea{width:100%;padding:8px;margin-top:6px;border:none;border-radius:6px}
button{background:#2563eb;color:white;font-weight:bold}
.semaforo{width:22px;height:22px;border-radius:50%;display:inline-block;background:gray}
.chat-box{background:#0b0e1a;border-radius:6px;padding:6px;height:200px;overflow-y:auto}
.chat-msg{font-size:14px;margin:4px 0}
.user{color:#7dd3fc}.ia{color:#a7f3d0}
</style>
</head>

<body>

<header>ğŸ§  IntuiciÃ³n XAUUSD â€“ IA Copiloto</header>

<div class="container">

<!-- GRÃFICA -->
<div class="card">
<h3>ğŸ“ˆ GrÃ¡fica</h3>
<div id="tv_chart" style="height:420px;"></div>
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
new TradingView.widget({
  symbol:"OANDA:XAUUSD",
  interval:"15",
  timezone:"Europe/Madrid",
  theme:"dark",
  container_id:"tv_chart",
  studies:["RSI@tv-basicstudies","EMA@tv-basicstudies"]
});
</script>

<h3>ğŸ’¬ Chat IA</h3>
<div class="chat-box" id="chat"></div>
<textarea id="msg" placeholder="Habla con la IA..."></textarea>
<button onclick="enviar()">Enviar</button>
</div>

<!-- PANEL IA -->
<div class="card">

<h3>ğŸ§  IntuiciÃ³n (ANTES)</h3>
<div id="contexto">Contexto: â€”</div>
<div id="tiempoEntrada">â±ï¸ Tiempo Ã³ptimo: â€”</div>
<div>â³ Entrada en: <span id="contador">â€”</span></div>

<hr>

<h3>ğŸ“Œ Avisar a la IA</h3>
<button onclick="iniciarTrade('BUY')" style="background:#14532d">ğŸŸ¢ Ya entrÃ© en COMPRA</button>
<button onclick="iniciarTrade('SELL')" style="background:#7f1d1d">ğŸ”´ Ya entrÃ© en VENTA</button>

<div id="direccion">DirecciÃ³n: â€”</div>
<div id="ganancia">Ganancia: 0</div>
<div>SemÃ¡foro <span id="semaforo" class="semaforo"></span></div>
<div id="mensajeIA"></div>

</div>
</div>

<script>
const API_KEY="d3cd94ff08974ed893ad7f77c1cd3b87";
const SYMBOL="XAU/USD";
const INTERVAL="15min";

let tradeActivo=null,precioEntrada=0,ultimoPrecio=0;
let contadorInterval=null,tiempoRestante=0;

function enviar(){
  if(!msg.value) return;
  chat.innerHTML+=`<div class="chat-msg user">ğŸ§‘â€ğŸ’» ${msg.value}</div>`;
  setTimeout(()=>chat.innerHTML+=`<div class="chat-msg ia">ğŸ¤– MantÃ©n disciplina y sigue el plan.</div>`,500);
  msg.value="";
  chat.scrollTop=chat.scrollHeight;
}

function iniciarContador(m){
  clearInterval(contadorInterval);
  tiempoRestante=m*60;
  contadorInterval=setInterval(()=>{
    tiempoRestante--;
    contador.innerText=Math.floor(tiempoRestante/60)+":"+String(tiempoRestante%60).padStart(2,"0");
    if(tiempoRestante<=0){clearInterval(contadorInterval);contador.innerText="ENTRAR AHORA";}
  },1000);
}

function iniciarTrade(tipo){
  tradeActivo=tipo;
  precioEntrada=ultimoPrecio;
  direccion.innerText="DirecciÃ³n: "+(tipo==="BUY"?"â¬†ï¸ COMPRA":"â¬‡ï¸ VENTA");
  mensajeIA.innerText="ğŸ¤– Trade activo. Ahora te acompaÃ±o.";
}

function calcularRSI(c){
  let g=0,l=0;
  for(let i=c.length-14;i<c.length-1;i++){
    const d=c[i+1]-c[i]; d>=0?g+=d:l-=d;
  }
  return 100-(100/(1+g/(l||1)));
}

async function datos(){
  const r=await fetch(`https://api.twelvedata.com/time_series?symbol=${SYMBOL}&interval=${INTERVAL}&outputsize=50&apikey=${API_KEY}`);
  const d=await r.json(); if(!d.values) return;
  const c=d.values.map(v=>+v.close).reverse();
  ultimoPrecio=c.at(-1);
  const rsi=calcularRSI(c);
  const mom=c.at(-1)-c.at(-6);

  if(!tradeActivo){
    if(rsi>45&&rsi<55){contexto.innerText="Mercado cargÃ¡ndose";tiempoEntrada.innerText="Esperar 5 min";iniciarContador(5);}
    else if(rsi<35&&mom>0){contexto.innerText="Rebote probable";tiempoEntrada.innerText="Entrada en 2 min";iniciarContador(2);}
    else{contexto.innerText="No claro";contador.innerText="â€”";}
  }else{
    const g=tradeActivo==="BUY"?ultimoPrecio-precioEntrada:precioEntrada-ultimoPrecio;
    ganancia.innerText="Ganancia: "+g.toFixed(2);
    if(g>0){semaforo.style.background="lime";mensajeIA.innerText="ğŸŸ¢ MantÃ©n";}
    else{semaforo.style.background="red";mensajeIA.innerText="ğŸ”´ Riesgo alto";}
  }
}
datos();setInterval(datos,15000);
</script>

</body>
</html>
