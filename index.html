<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Intuici√≥n XAUUSD ¬∑ IA Copiloto</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f1220;
  color:#eaeaff;
}
header{
  padding:12px;
  text-align:center;
  background:#161a33;
  font-size:20px;
  font-weight:bold;
}
.container{padding:10px;}
.card{
  background:#161a33;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
h3{color:#7dd3fc;margin:6px 0;}
.signal{
  text-align:center;
  font-size:22px;
  padding:12px;
  border-radius:8px;
}
.buy{background:#14532d;color:#4ade80;}
.sell{background:#7f1d1d;color:#f87171;}
.wait{background:#1f2933;color:#facc15;}
button,textarea{
  width:100%;
  margin-top:6px;
  padding:8px;
  border-radius:6px;
  border:none;
}
button{
  background:#2563eb;
  color:white;
  font-weight:bold;
}
.chat-box{
  height:200px;
  overflow-y:auto;
  background:#0b0e1a;
  padding:6px;
  border-radius:6px;
}
.chat-msg{font-size:14px;margin:4px 0;}
.user{color:#7dd3fc;}
.ia{color:#a7f3d0;}
</style>
</head>

<body>

<header>üß† Intuici√≥n XAUUSD ¬∑ IA Copiloto</header>

<div class="container">

<!-- GR√ÅFICA -->
<div class="card">
<h3>üìà Gr√°fica XAUUSD</h3>
<div id="tv_chart" style="height:420px;"></div>
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
new TradingView.widget({
  symbol:"OANDA:XAUUSD",
  interval:"15",
  timezone:"Europe/Madrid",
  theme:"dark",
  container_id:"tv_chart"
});
</script>
</div>

<!-- SEM√ÅFORO + INTUICI√ìN -->
<div class="card">
<h3>üö¶ Se√±al t√©cnica</h3>
<div id="signal" class="signal wait">Esperando datos‚Ä¶</div>

<div id="tiempoEntrada">‚è±Ô∏è Intuici√≥n: ‚Äî</div>
<div id="contadorBox">‚è≥ Entrada en: <span id="contador">‚Äî</span></div>
</div>

<!-- AVISAR ENTRADA -->
<div class="card">
<h3>üßë‚Äçüíª Gesti√≥n</h3>
<button onclick="entrar()">‚úÖ Ya entr√© al mercado</button>
<div id="estadoTrade">Sin trade activo</div>
<div id="tiempoSalida">‚è±Ô∏è Tiempo √≥ptimo de cierre: ‚Äî</div>
</div>

<!-- CHAT -->
<div class="card">
<h3>üí¨ Chat IA</h3>
<div class="chat-box" id="chat"></div>
<textarea id="msg" placeholder="Habla con la IA..."></textarea>
<button onclick="enviar()">Enviar</button>
</div>

</div>

<script>
// ================= CONFIG =================
const API_KEY = "d3cd94ff08974ed893ad7f77c1cd3b87";
const SYMBOL = "XAUUSD";

// ================= ESTADO =================
let precioAnterior = null;
let se√±alTecnica = null;
let tradeActivo = false;
let contadorInterval = null;
let tiempoRestante = 0;

// ================= CHAT =================
function addMsg(t,c){
  chat.innerHTML += `<div class="chat-msg ${c}">${t}</div>`;
  chat.scrollTop = chat.scrollHeight;
}
function enviar(){
  if(!msg.value) return;
  addMsg("üßë‚Äçüíª " + msg.value,"user");
  msg.value="";
  setTimeout(()=>{
    addMsg("ü§ñ IA: Observa la estructura, no anticipes.","ia");
  },600);
}

// ================= CONTADOR =================
function iniciarContador(min){
  clearInterval(contadorInterval);
  tiempoRestante = min * 60;
  contadorInterval = setInterval(()=>{
    tiempoRestante--;
    contador.innerText =
      Math.floor(tiempoRestante/60) + ":" +
      (tiempoRestante%60).toString().padStart(2,"0");

    if(tiempoRestante <= 0){
      clearInterval(contadorInterval);
      contador.innerText = "ENTRAR AHORA";
    }
  },1000);
}

// ================= ANALISIS TECNICO (API) =================
function analizarTecnico(price, prev){
  const cambio = price - prev;

  if(cambio > 0.6) return "buy";
  if(cambio < -0.6) return "sell";

  return null;
}

// ================= INTUICI√ìN (TIMING) =================
function analizar(price){
  if(precioAnterior === null){
    precioAnterior = price;
    return;
  }

  const nuevaSe√±al = analizarTecnico(price, precioAnterior);

  // NUEVA SE√ëAL DETECTADA
  if(nuevaSe√±al && nuevaSe√±al !== se√±alTecnica){
    se√±alTecnica = nuevaSe√±al;

    signal.className =
      nuevaSe√±al === "buy" ? "signal buy" : "signal sell";
    signal.innerText =
      nuevaSe√±al === "buy" ? "üü¢ POSIBLE COMPRA" : "üî¥ POSIBLE VENTA";

    tiempoEntrada.innerText = "‚è±Ô∏è Intuici√≥n: entrada en 2‚Äì3 min";
    iniciarContador(3);

    addMsg(
      "ü§ñ IA: Detecto " +
      (nuevaSe√±al==="buy"?"presi√≥n alcista":"presi√≥n bajista") +
      ". Espera confirmaci√≥n.",
      "ia"
    );
  }

  // SIN VENTAJA
  if(!nuevaSe√±al){
    se√±alTecnica = null;
    signal.className = "signal wait";
    signal.innerText = "üü° SIN VENTAJA";
    tiempoEntrada.innerText = "‚è±Ô∏è Intuici√≥n: esperando contexto";
    clearInterval(contadorInterval);
    contador.innerText = "‚Äî";
  }

  precioAnterior = price;
}

// ================= DATOS API =================
async function datos(){
  try{
    const r = await fetch(
      `https://api.twelvedata.com/quote?symbol=${SYMBOL}&apikey=${API_KEY}`
    );
    const d = await r.json();
    if(d.price && !tradeActivo){
      analizar(parseFloat(d.price));
    }
  }catch(e){
    console.log("Error API", e);
  }
}
setInterval(datos, 15000);

// ================= ENTRADA =================
function entrar(){
  tradeActivo = true;
  estadoTrade.innerText = "üìå Trade activo";
  tiempoSalida.innerText = "‚è±Ô∏è Cierre estimado: 5‚Äì10 min";
  addMsg("ü§ñ IA: Trade registrado. Gestiona sin miedo.","ia");
}
</script>

</body>
</html>
