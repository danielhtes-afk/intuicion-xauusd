<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>IA XAUUSD AUTO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f1220;
  color:#fff;
}
header{
  padding:10px;
  text-align:center;
  background:#15182e;
  font-weight:bold;
}
.container{
  display:grid;
  grid-template-columns: 2fr 1fr;
  gap:10px;
  padding:10px;
}
.panel{
  background:#15182e;
  border-radius:10px;
  padding:10px;
}
h3{margin:5px 0;}
.led{
  width:15px;height:15px;border-radius:50%;
  display:inline-block;margin-right:5px;
}
.verde{background:#00ff88;}
.rojo{background:#ff4d4d;}
.amarillo{background:#ffd84d;}
.chat{
  height:200px;
  overflow:auto;
  background:#0c0f1e;
  padding:5px;
  border-radius:5px;
}
input,button{
  width:100%;
  padding:8px;
  margin-top:5px;
  border:none;
  border-radius:5px;
}
button{background:#00ff88;color:#000;font-weight:bold;}
.estado{font-size:14px;margin-top:5px;}
</style>
</head>

<body>

<header>ü§ñ IA-XAUUSD-AUTO ¬∑ Copiloto en tiempo real</header>

<div class="container">

  <!-- GR√ÅFICA -->
  <div class="panel">
    <h3>üìà Gr√°fica XAUUSD (TradingView)</h3>
    <div id="tvchart" style="height:400px;"></div>
  </div>

  <!-- PANEL IA -->
  <div class="panel">
    <h3>üß† Estado IA</h3>
    <div class="estado"><span id="ledEstado" class="led amarillo"></span><span id="textoEstado">Esperando datos‚Ä¶</span></div>
    <div class="estado" id="mensajeCierre">Sin trade activo</div>

    <h3>üí¨ Chat IA</h3>
    <div class="chat" id="chatBox"></div>
    <input id="chatInput" placeholder="Pregunta a la IA‚Ä¶">
    <button onclick="enviarChat()">Enviar</button>
  </div>

</div>

<!-- TRADINGVIEW -->
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
new TradingView.widget({
  autosize:true,
  symbol:"OANDA:XAUUSD",
  interval:"1",
  timezone:"Etc/UTC",
  theme:"dark",
  style:"1",
  locale:"es",
  container_id:"tvchart"
});
</script>

<script>
// ===============================
// CONFIGURACI√ìN
// ===============================
const API_KEY = "d3cd94ff08974ed893ad7f77c1cd3b87"; // üëà PON AQU√ç TU API KEY
const SYMBOL = "XAU/USD";
const INTERVAL = "1min";

// ===============================
// VARIABLES GLOBALES
// ===============================
let velas = [];
let ultimaVela = null;

// Trade
let tradeActivo = false;
let tipoTrade = null;
let precioEntrada = 0;

// ===============================
// UTILIDADES UI
// ===============================
const led = document.getElementById("ledEstado");
const textoEstado = document.getElementById("textoEstado");
const mensajeCierre = document.getElementById("mensajeCierre");

function setLed(color,texto){
  led.className = "led " + color;
  textoEstado.innerText = texto;
}

// ===============================
// OBTENER DATOS TWELVEDATA
// ===============================
async function obtenerVelas(){
  const url = `https://api.twelvedata.com/time_series?symbol=${SYMBOL}&interval=${INTERVAL}&outputsize=30&apikey=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  if(!data.values) return;
  velas = data.values.reverse();
  ultimaVela = velas[velas.length-1];
  analizarMercado();
}

// ===============================
// IA DE AN√ÅLISIS
// ===============================
function analizarMercado(){
  if(velas.length < 3) return;

  const v1 = velas[velas.length-1];
  const v2 = velas[velas.length-2];

  const c1 = Number(v1.close) - Number(v1.open);
  const c2 = Number(v2.close) - Number(v2.open);

  // COMPRA
  if(!tradeActivo && c1 > 0 && c2 > 0){
    abrirTrade("COMPRA", Number(v1.close));
    setLed("verde","COMPRA confirmada");
    agregarChat("IA","Se√±al de COMPRA con impulso.");
  }

  // VENTA
  if(!tradeActivo && c1 < 0 && c2 < 0){
    abrirTrade("VENTA", Number(v1.close));
    setLed("rojo","VENTA confirmada");
    agregarChat("IA","Se√±al de VENTA con presi√≥n bajista.");
  }

  evaluarCierre();
}

// ===============================
// IA DE CIERRE
// ===============================
function abrirTrade(tipo,precio){
  tradeActivo = true;
  tipoTrade = tipo;
  precioEntrada = precio;
  mensajeCierre.innerText = `üü¢ Trade ${tipo} abierto en ${precio}`;
}

function evaluarCierre(){
  if(!tradeActivo) return;

  const open = Number(ultimaVela.open);
  const close = Number(ultimaVela.close);
  const cuerpo = Math.abs(close-open);

  if(tipoTrade==="COMPRA" && close < open){
    cerrarTrade("üî¥ Vela contraria detectada");
  }
  if(tipoTrade==="VENTA" && close > open){
    cerrarTrade("üü¢ Vela contraria detectada");
  }
  if(cuerpo < 0.05){
    cerrarTrade("‚ö†Ô∏è Impulso d√©bil, posible rango");
  }
}

function cerrarTrade(motivo){
  tradeActivo = false;
  tipoTrade = null;
  setLed("amarillo","Esperando oportunidad");
  mensajeCierre.innerText = motivo;
  agregarChat("IA",motivo);
}

// ===============================
// CHAT IA
// ===============================
function agregarChat(quien,texto){
  const box = document.getElementById("chatBox");
  box.innerHTML += `<div><b>${quien}:</b> ${texto}</div>`;
  box.scrollTop = box.scrollHeight;
}

function enviarChat(){
  const input = document.getElementById("chatInput");
  const msg = input.value;
  if(!msg) return;
  agregarChat("T√∫",msg);
  input.value="";
  responderIA(msg);
}

function responderIA(msg){
  let respuesta="Estoy observando el mercado.";
  if(tradeActivo){
    respuesta = "Trade activo. Vigila el impulso y espera confirmaci√≥n.";
  }
  if(msg.toLowerCase().includes("cerrar")){
    respuesta = "A√∫n no hay se√±al clara de cierre.";
  }
  agregarChat("IA",respuesta);
}

// ===============================
// LOOP
// ===============================
setLed("amarillo","Esperando datos‚Ä¶");
setInterval(obtenerVelas, 60000);
obtenerVelas();
</script>

</body>
</html>
