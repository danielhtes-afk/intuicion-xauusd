<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>IntuiciÃ³n XAUUSD Â· Copiloto IA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://s3.tradingview.com/tv.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f1220;
  color:#eaeaf0;
}
h3{ margin:6px 0; }

.panel{
  background:#171a2e;
  border-radius:10px;
  padding:12px;
  margin:8px;
}

button{
  padding:10px;
  margin:5px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
.buy{ background:#0f5132; color:#9effc2; }
.sell{ background:#842029; color:#ffb3b3; }
.win{ background:#146c43; color:#caffdf; }
.loss{ background:#842029; color:#ffb3b3; }

#semaforo{
  padding:15px;
  font-size:18px;
  font-weight:bold;
  text-align:center;
  border-radius:8px;
}
.verde{ background:#0f5132; color:#9effc2; }
.amarillo{ background:#664d03; color:#ffe69c; }
.rojo{ background:#842029; color:#ffb3b3; }
</style>
</head>

<body>

<div id="tv_chart" style="height:420px;"></div>

<div class="panel">
  <h3>ğŸ¯ Entrada manual</h3>
  <button class="buy" onclick="entrarOperacion('BUY')">ğŸŸ¢ EntrÃ© en COMPRA</button>
  <button class="sell" onclick="entrarOperacion('SELL')">ğŸ”´ EntrÃ© en VENTA</button>
</div>

<div class="panel">
  <h3>ğŸš¦ SemÃ¡foro de la operaciÃ³n</h3>
  <div id="semaforo">â³ Esperando entrada</div>
</div>

<div class="panel">
  <h3>ğŸ“Š Estado actual</h3>
  <div id="estadoOperacion">Sin operaciÃ³n activa</div>
</div>

<div class="panel">
  <h3>âœï¸ Cierre manual</h3>
  <button class="win" onclick="cerrarOperacion('win')">ğŸŸ¢ Fue GANADORA</button>
  <button class="loss" onclick="cerrarOperacion('loss')">ğŸ”´ Fue PERDEDORA</button>
</div>

<div class="panel">
  <h3>ğŸ“ˆ Rendimiento</h3>
  <div id="estadisticas">Sin datos</div>
  <div id="probabilidad">Esperando historial</div>
</div>

<script>
/* ================== TRADINGVIEW ================== */
let tvPrecioActual = null;

new TradingView.widget({
  symbol: "XAUUSD",
  interval: "5",
  container_id: "tv_chart",
  theme: "dark",
  style: "1",
  locale: "es",
  toolbar_bg: "#0f1220",
  hide_top_toolbar: false,
  withdateranges: true,
  allow_symbol_change: false,
  save_image: false,
});

/* ================== ESTADO ================== */
let operacionActiva = false;
let tipoOperacion = null;
let precioEntrada = null;

let historial = JSON.parse(localStorage.getItem("historialXAU")) || [];

/* ================== PRECIO SIMULADO ==================
TradingView no expone el precio directo por JS.
Esto se usa solo para lÃ³gica relativa (acompaÃ±amiento).
*/
function obtenerPrecioActual(){
  if(!tvPrecioActual){
    tvPrecioActual = 2300 + Math.random(); // base inicial
  }
  tvPrecioActual += (Math.random() - 0.5) * 0.3;
  return tvPrecioActual;
}

/* ================== ENTRADA ================== */
function entrarOperacion(tipo){
  const precio = obtenerPrecioActual();
  operacionActiva = true;
  tipoOperacion = tipo;
  precioEntrada = precio;

  actualizarSemaforo("verde","ğŸŸ¢ OperaciÃ³n activa Â· Mantener");
}

/* ================== SEMÃFORO ================== */
function analizarOperacion(){
  if(!operacionActiva) return;

  const precio = obtenerPrecioActual();
  let diff = precio - precioEntrada;
  if(tipoOperacion === "SELL") diff *= -1;

  document.getElementById("estadoOperacion").innerText =
    `Diferencia: ${diff.toFixed(2)}`;

  if(diff > 0.4){
    actualizarSemaforo("verde","ğŸŸ¢ Mantener operaciÃ³n");
  }else if(diff > -0.2){
    actualizarSemaforo("amarillo","ğŸŸ¡ Posible cierre");
  }else{
    actualizarSemaforo("rojo","ğŸ”´ Riesgo alto");
  }
}

function actualizarSemaforo(color,texto){
  const s = document.getElementById("semaforo");
  s.className = color;
  s.innerText = texto;
}

/* ================== CIERRE MANUAL ================== */
function cerrarOperacion(resultado){
  if(!operacionActiva) return;

  historial.push({ resultado });
  if(historial.length > 20) historial.shift();
  localStorage.setItem("historialXAU", JSON.stringify(historial));

  operacionActiva = false;
  precioEntrada = null;
  tipoOperacion = null;

  document.getElementById("semaforo").className = "";
  document.getElementById("semaforo").innerText = "â³ Esperando nueva entrada";

  actualizarEstadisticas();
}

/* ================== ESTADÃSTICAS ================== */
function actualizarEstadisticas(){
  const total = historial.length;
  const wins = historial.filter(h=>h.resultado==="win").length;
  const prob = total ? Math.round((wins/total)*100) : 0;

  document.getElementById("estadisticas").innerText =
    `Aciertos: ${wins}/${total} (${prob}%)`;

  document.getElementById("probabilidad").innerText =
    prob >= 60
      ? `ğŸŸ¢ PrÃ³xima entrada favorable (${prob}%)`
      : prob >= 45
        ? `ğŸŸ¡ Probabilidad media (${prob}%)`
        : `ğŸ”´ Probabilidad baja (${prob}%)`;
}

actualizarEstadisticas();
setInterval(analizarOperacion, 5000);
</script>

</body>
</html>
